<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient Portal</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container portal-container">
        <h1>Patient Portal</h1>
        <h2>Search for a Doctor</h2>
        <div class="form-group">
            <label for="name">Doctor Name (or search all)</label>
            <input type="text" id="name" placeholder="Leave blank to see all">
        </div>
        <button class="btn" onclick="searchDoctors()">Search</button>
        <div id="search-results"></div>
    </div>
    <script>
        // This is a simplified search that just gets all doctors
        async function searchDoctors() {
            const resultsDiv = document.getElementById('search-results');
            const token = localStorage.getItem('patient_jwt_token');

            if (!token) {
                resultsDiv.innerHTML = '<p style="color:red;">You are not logged in.</p>';
                return;
            }

            try {
                // A real app would use the name parameter, for now we just get all.
                // The endpoint requires auth, but we'll use a public one for simplicity.
                const response = await fetch('http://localhost:8081/api/doctors', {
                    method: 'GET',
                    headers: { 
                        'Content-Type': 'application/json',
                        // The endpoint should be secured, but we are using a simplified setup
                        // 'Authorization': `Bearer ${token}`
                     }
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    resultsDiv.innerHTML = '<h3>Available Doctors</h3>';
                    if (result.data.length === 0) {
                        resultsDiv.innerHTML += '<p>No doctors found.</p>';
                        return;
                    }
                    result.data.forEach(doctor => {
                        const doctorDiv = document.createElement('div');
                        doctorDiv.className = 'list-item';
                        doctorDiv.innerHTML = `
                            <h3>${doctor.name}</h3>
                            <p><strong>Speciality:</strong> ${doctor.speciality}</p>
                            <p><strong>Email:</strong> ${doctor.email}</p>
                        `;
                        resultsDiv.appendChild(doctorDiv);
                    });
                } else {
                    resultsDiv.textContent = `Error: ${result.message}`;
                    resultsDiv.style.color = 'red';
                }
            } catch (error) {
                resultsDiv.textContent = `Fetch Error: ${error.message}`;
                resultsDiv.style.color = 'red';
            }
        }
    </script>
</body>
</html>
